<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.backend.itryp">
	<!-- 판매목록(+새로운 문의) 조회 -->
	<select id="marketQnaList">
		SELECT m.market_no
		     , m.user_id
		     , m.market_category
		     , m.market_title
		     , m.market_price
		     , q.qna_count
		FROM TB_MARKET m
			, (SELECT COUNT(user_Id) qna_count, market_no
			    FROM TB_QNA
			    WHERE qna_step = 0
			    GROUP BY market_no) q
		WHERE m.market_no = q.market_no(+)
		<if test="new != null and new == 1">
			AND q.market_no IS NOT NULL
		</if>
		<if test="new != null and new == 0">
			AND (q.market_no IS NOT NULL OR q.market_no IS NULL)
		</if>
	</select>
	
	<!-- 신고 목록 조회(회원4, 글0, 댓글1) -->
	<select id="reportList" parameterType="map" resultType="map">
				SELECT report_no
		     , user_id
		     , report_type
		     , report_num
		     , report_group
		     , report_step
		     , report_user
		     , report_reason
		     , report_date
		     , report_result
		  FROM TB_REPORT
		  <if test="report_type != null and report_type == 4">
		  	WHERE report_type = 4
		  </if>
		  <if test="report_type != null and report_type == 0">
		  	WHERE report_type = 0
		  </if>
		  <if test="report_type != null and report_type == 1">
		  	WHERE report_type = 1
		  </if>
		  <if test="new != null and new == 1">
		  	WHERE report_result = 0
		  </if>
		  ORDER BY report_date DESC
	</select>
	
	<!-- 신고 상태 수정 - 처리완료1 -->
	<update id="reportUpdate" parameterType="map">
		UPDATE TB_REPORT
		SET report_result = #{report_result}
		WHERE report_no = #{report_no}
	</update>
	
	<!-- 회원 상태 수정 - 기본0 차단2 -->
	<update id="userStatusUpdate" parameterType="map">
		UPDATE TB_USER
		SET status = #{status}
		WHERE user_id = #{user_id}
	</update>
	
	<!-- 글 상태 수정 - 기본0 차단1 -->
	<update id="boardStatusUpdate" parameterType="map">
		UPDATE TB_BOARD
		SET board_status = #{board_status}
		WHERE board_no = #{board_no}
	</update>
	
	<!-- 댓글 상태 수정 - 기본0 차단2 -->
	<update id="commentStatusUpdate" parameterType="map">
		UPDATE TB_B_COMMENT
		SET comment_status = #{comment_status}
		WHERE comment_no = #{comment_no}
		AND comment_step = #{comment_step}
	</update>
	
	<!-- 차단 회원 목록 조회 -->
	<select id="banUserList" parameterType="map" resultType="map">
		SELECT user_id
		     , user_nickname
		     , user_name
		     , user_phone
		     , user_level
		     , status
		FROM TB_USER
		WHERE status = 2
	</select>
	
	<!-- 차단 글 목록 조회 -->
	<select id="banBoardList" parameterType="map" resultType="map">
		SELECT board_no
		     , user_id
		     , board_category
		     , board_title
		     , board_date
		     , board_hit
		     , board_status
		FROM TB_BOARD
		WHERE board_status = 1
	</select>
	
	<!-- 차단 댓글 목록 조회 -->
	<select id="banCommentList" parameterType="map" resultType="map">
		SELECT board_no
		     , user_id
		     , comment_no
		     , comment_step
		     , comment_date
		     , comment_status
		FROM TB_B_COMMENT 
		WHERE comment_status = 2
	</select>

	<!-- 차단 글 삭제 -->
	<delete id="banBoardDelete" parameterType="map">
		DELETE FROM TB_BOARD
		WHERE board_no = #{board_no}
		AND board_status = 1
	</delete>
	
	<!-- 차단 댓글 삭제-->
	<delete id="banCommentDelete" parameterType="map">
		DELETE FROM TB_B_COMMENT
		WHERE comment_no = #{comment_no}
		AND comment_step = #{comment_step}
		AND comment_statue = 2
	</delete>
	
	<!-- 탈퇴(신청) 회원 목록 조회 -->
	<select id="resignList" parameterType="map" resultType="map">
		SELECT u.user_id
		     , u.user_nickname
		     , u.user_name
		     , u.user_phone
		     , u.user_level
		     , u.status
		     , q.qna_title
		     , q.qna_content
		     , q.qna_date
		FROM TB_USER u, TB_QNA q
		WHERE u.user_id = q.user_id
			AND q.qna_sort = 3
		<if test="new != null and new == 1">
			AND q.qna_step = 0
		</if>
		ORDER BY q.qna_date DESC
	</select>
	
		<!-- 탈퇴(신청) 회원 상태 수정 탈퇴1 -->
	<update id="resignUpdate" parameterType="map">
		UPDATE TB_USER
		SET status = #{status}
		WHERE user_id = #{user_id}
	</update>
	
	<!-- 탈퇴 회원 삭제  -->
	<delete id="resignDelete" parameterType="map">
		DELETE FROM TB_USER
		WHERE user_id = #{user_id}
		AND status = 1
	</delete>
</mapper>