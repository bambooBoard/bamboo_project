<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.backend.itryp">
	<!-- 회원가입 -->
	<insert id="memberInsert" parameterType="map">
		INSERT INTO TB_USER(
		user_id
		,user_pw
		,user_email
		,user_nickname
		,user_name
		,user_phone
		,user_zipcode
		,user_address
		,user_address_detail
		)
		VALUES(
		<if test='USER_ID!= null'>
			,#{USER_ID}
		</if>
		<if test='USER_PW!= null'>
			,#{USER_PW}
		</if>
		<if test='USER_EMAIL!= null'>
			,#{USER_EMAIL}
		</if>
		<if test='USER_NICKNAME!= null'>
			,#{USER_NICKNAME}
		</if>
		<if test='USER_NAME!= null'>
			,#{USER_NAME}
		</if>
		<if test='USER_PHONE!= null'>
			,#{USER_PHONE}
		</if>
		<if test='USER_ZIPCODE!= null'>
			,#{USER_ZIPCODE}
		</if>
		<if test='USER_ADDRESS!= null'>
			,#{USER_ADDRESS}
		</if>
		<if test='USER_ADDRESS_DETAIL!= null'>
			,#{USER_ADDRESS_DETAIL}
		</if>
		)
	</insert>


	<!-- 로그인, 회원정보 조회용 쿼리문 -->
	<select id="userInfo" parameterType="map" resultType="map">
		SELECT
			user_id
			,user_email
			,user_nickname
			,user_name
			,user_phone
			,user_zipcode
			,user_address
			,user_address_detail
		from TB_USER
		WHERE
			user_id=#{user_id} AND user_pw=#{user_pw} AND status = 0
	</select>
	
	<!-- 중복검사(아이디, 닉네임, 이메일), 이메일 찾기용 쿼리문 -->
	<select id ="checkInfo" parameterType="map" resultType="map">
		SELECT
		<if test='user_id!= null'>
			user_id
		</if>
		<if test='user_nickname!= null'>
			user_nickname
		</if>
		<if test='user_email!= null'>
			user_email
		</if>
		FROM TB_USER
		<where>
		<if test='user_id!= null and user_id.length()>0'>
			user_id = #{user_id}
		</if>
		<if test='user_nickname!= null and user_nickname.length()>0'>
			user_nickname = #{user_nickname}
		</if>
		<if test='user_email!= null and user_email.length()>0'>
			user_email = #{user_email}
		</if>
		</where>
	</select>
	
	
	<!-- 아이디 중복검사 -->
	<select id="idCheck" parameterType="map" resultType="int">
		select user_id from TB_USER
		where user_id = #{user_id}
	</select>

	<!-- 닉네임 중복검사, 추천인(닉네임)유무 확인 -->
	<select id="nickCheck" parameterType="map" resultType="int">
		select user_nickname from TB_USER
		where user_nickname = #{user_nickname}
	</select>

	<!-- 이메일 중복검사 -->
	<select id="emailCheck" parameterType="map" resultType="int">
		select user_email from TB_USER
		where user_email = #{user_email}
	</select>

	<!-- 아이디(이메일) 찾기 -->
	<select id="findMyEmail" parameterType="map" resultType="string">
		select
		user_email from TB_USER
		where user_email = #{user_email} and status = 0
	</select>

	<!-- 회원정보 수정 : 수정가능한 정보 : 닉네임, 비밀번호, 핸드폰번호(재인증), 주소 -->
	<update id="memberUpdate" parameterType="map">
		update TB_USER
		<trim prefix="SET" prefixOverrides=",">
			<if test='user_nickname!=null and user_nickname.length>0'>
				user_nickname = #{user_nickname}
			</if>
			<if test='user_pw !=null and user_pw.length()>0'>
				,user_pw = #{user_pw}
			</if>
			<if test='user_phone!=null and user_phone.length()>0'>
				,user_phone = #{user_phone}
			</if>
			<if test='user_zipcode!=null and user_zipcode.length()>0'>
				,user_zipcode = #{user_zipcode}
			</if>
			<if test='user_address!=null and user_address.length()>0'>
				,user_address = #{user_address}
			</if>
			<if
				test='user_address_detail!=null and user_address_detail.length()>0'>
				,user_address_detail = #{user_address_detail}
			</if>
		</trim>
	</update>

	<!-- 회원 탈퇴 (바로 삭제 X, status를 1로 변경) -->
	<update id="memberDelete" parameterType="map">
		update TB_USER
		set status
		= 1
		WHERE user_id = #{user_id}
	</update>

</mapper>